/*
 * schedule.h
 *
 *  Created on: Oct 27, 2025
 *      Author: ASUS
 */
#ifndef INC_SCH_H_
#define INC_SCH_H_

#include "main.h"
#include <stdint.h>
#include <stdbool.h>

#define SCH_MAX_TASKS 10

typedef enum {
    ERROR_SCH_NO_ERROR = 0,                  // Không có lỗi
    ERROR_SCH_TOO_MANY_TASKS = 1,           // Quá nhiều task trong hàng đợi
    ERROR_SCH_CANNOT_DELETE_TASK = 2,       // Không thể xóa task
    ERROR_SCH_WAITING_FOR_SLAVE_TO_ACK = 3, // Đang chờ phản hồi từ slave
    ERROR_SCH_WAITING_FOR_START_COMMAND_FROM_MASTER = 4, // Đang chờ lệnh bắt đầu từ master
    ERROR_SCH_ONE_OR_MORE_SLAVES_DID_NOT_START = 5, // Một hoặc nhiều slave không khởi động
    ERROR_SCH_LOST_SLAVE = 6,               // Mất kết nối với slave
    ERROR_SCH_CAN_BUS_ERROR = 7,            // Lỗi bus CAN
    ERROR_I2C_WRITE_BYTE_AT24C64 = 8        // Lỗi ghi byte I2C
} SCH_Error_Code_t;

typedef struct {
void (*funcPtr)(void);
uint32_t delay;
uint32_t period;
uint8_t runme;
uint8_t taskID;
bool isEmpty;
bool isOneShot;
} Tasks;

extern Tasks taskList[SCH_MAX_TASKS];
extern uint8_t currentTasks;
extern uint32_t ERROR_CODE_G;

void SCH_Init(void);
uint32_t SCH_Add_Task(void (*task)(void), uint32_t delay, uint32_t period);
void SCH_Update(void);
void SCH_Dispatch_Tasks(void);
uint32_t SCH_Delete_Task(uint32_t taskID);
void SCH_Delete_All_Tasks(void);

#endif /* INC_SCH_H_ */
